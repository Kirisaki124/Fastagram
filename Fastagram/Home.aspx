<%@ Page Language="C#" AutoEventWireup="true" CodeBehind="Home.aspx.cs" Inherits="Fastagram.Home" %>
<%@ Import Namespace="Fastagram.Code.Model" %>
<%@ Import Namespace="Fastagram.Code.Data" %>
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
<head runat="server">
    <title></title>
     <script src="Scripts/jquery-3.3.1.min.js" ></script>
    <!--Reference the SignalR library. -->
    <script src="Scripts/jquery.signalR-2.4.1.min.js"></script>
    <!--Reference the autogenerated SignalR hub script. -->
    <script src="signalr/hubs"></script>
</head>
    <script type="text/javascript">
        var chat = $.connection.notifyHub;

        $(() => {

            chat.client.addComment = (message) => {
                alert("ell")
            }

            $.connection.hub.start().done(() => {
                $('#sendmessage').click(() => {
                    // Call the Send method on the hub. 
                    chat.server.abc($('#message').val());
                    // Clear text box and reset focus for next comment. 
                    $('#message').val('').focus();
                });
            })

            
        });

        function addComment(id, userId) {
            alert('lffsdfsd')
            var comment = $('#post' + id).val();
            chat.server.addComment(id, userId, comment);
            // Clear text box and reset focus for next comment.
        }
        
</script>
<body>
    <a href="Profile">Profile<a/>
    <form id="form1" runat="server">
        New feed here <br/>
        <%
            foreach(Post item in listPost)
            {
                %>
                    <h1 id="postId"><%=item.Id %></h1>
                    <h1><%=item.UserId %></h1>
                    <a href="Detail?id=<%=item.Id %>"><img src='<%=imagePath + item.Image %>'/></a>
                    <h1><%=item.Content %></h1>
                    <h1><%=item.Date %></h1>
                    comment post
                    <%
                        foreach(Comment comment in item.Comments)
                        {
                            %>
                                <h1><%=Manager.GetUserByID(comment.UserId).Name %></h1>
                                <p><%=comment.Content %></p>
                            <%
                        }
                    %>
                   
                    <input id="post<%=item.Id %>" type="text"/>
                    <button onclick='addComment(<%=item.Id %>, <%=((User) Session["user"]).Id %>)'>comment</button>
                    
                <%
                    
            }
        %>
        <div>
            create post <br/>
            <asp:FileUpload ID="fuImage" runat="server" accept=".jpg, .png, .jpeg"/>
            <asp:Button ID="btnUpload" runat="server" Text="Button" OnClick="btnUpload_Click" />
        </div>
        <asp:Button ID="btnSignout" runat="server" Text="Signout" OnClick="btnSignout_Click"/>
    </form>

</body>
</html>
